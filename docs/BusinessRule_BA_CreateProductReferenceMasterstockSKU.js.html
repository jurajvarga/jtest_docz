<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: BusinessRule_BA_CreateProductReferenceMasterstockSKU.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: BusinessRule_BA_CreateProductReferenceMasterstockSKU.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*===== export metadata =====
{
  "contextId" : "Context1",
  "workspaceId" : "Approved"
}
*/
/*===== business rule definition =====
{
  "id" : "BA_CreateProductReferenceMasterstockSKU",
  "type" : "BusinessAction",
  "setupGroups" : [ "ProductPricingRules" ],
  "name" : "BA_CreateProductReferenceMasterstockSKU",
  "description" : null,
  "scope" : "Global",
  "validObjectTypes" : [ "Equipment", "Product", "Product_Kit", "Service_Conjugates" ],
  "allObjectTypesValid" : false,
  "runPrivileged" : true,
  "onApprove" : "Never",
  "dependencies" : [ {
    "libraryId" : "BL_Library",
    "libraryAlias" : "bl_library"
  } ]
}
*/
/*===== business rule plugin definition =====
{
  "pluginId" : "JavaScriptBusinessActionWithBinds",
  "binds" : [ {
    "contract" : "CurrentObjectBindContract",
    "alias" : "currentObject",
    "parameterClass" : "null",
    "value" : null,
    "description" : null
  }, {
    "contract" : "LoggerBindContract",
    "alias" : "logger",
    "parameterClass" : "null",
    "value" : null,
    "description" : null
  } ],
  "messages" : [ ],
  "pluginType" : "Operation"
}
*/
exports.operation0 = function (currentObject,logger,bl_library) {
/**
script purpose: Create references from Product to MasterStock and SKU.
valid object type: Product
bindings: currentObject, logger
dependencies: BL_Library
business rule key for locating rows in main STEP log file: BA_CreateProductReferenceMasterstockSKU
**/

// variables for logging
var currentObjectID = "Current Object ID: " + currentObject.getID();
var businessRule = "BA_CreateProductReferenceMasterstockSKU";

logger.info( bl_library.logRecord( [ businessRule, currentObjectID ] ) )

// collect child objects of the current object
var children = currentObject.getChildren();
logger.info( bl_library.logRecord( [ businessRule, "Children: " + children ] ) )

var masterStocks = [];

// Master Stocks
// try to create references from Product to MasterStock, only need to work with MasterStock objects
for ( i = 0; i &lt; children.size(); i++ ) {
    var child = children.get(i); // any child object
    if ( child.getObjectType().getID() == "MasterStock" ) {
        var masterStock = child;
        masterStocks.push( masterStock ); // collect Master Stock objects for later use
        var masterStockID = masterStock.getID();
        try {
            currentObject.createReference( masterStock, "Product_To_MasterStock" );
            logger.info( bl_library.logRecord( [ businessRule, "Created reference to", masterStockID ] ));
        } catch (e) {
            if ( e.javaException instanceof com.stibo.core.domain.reference.TargetAlreadyReferencedException ) {
                logger.info( bl_library.logRecord( [ businessRule, "Target already referenced for", masterStockID ] ));
            } else {
                logger.info( bl_library.logRecord( [ "Exception occurred", businessRule, currentObjectID, masterStockID, e ] ) );
                throw(e);
            }
        }
    }
}

// SKUs
// try to create references from Product to SKU, only need to work with SKU objects
for ( i = 0; i &lt; masterStocks.length; i++ ) {
    var masterStock = masterStocks[i];
    var masterStockChildren = masterStock.getChildren();
    for ( x = 0; x &lt; masterStockChildren.size(); x++ ) {
        var child = masterStockChildren.get(x);
        if ( child.getObjectType().getID() == "SKU" ) {
            var sku = child;
            var skuID = sku.getID();
            try {
                currentObject.createReference( sku, "Product_To_SKU" );
                logger.info( bl_library.logRecord( [ businessRule, "Created reference to", skuID ] ));
            } catch (e) {
                if ( e.javaException instanceof com.stibo.core.domain.reference.TargetAlreadyReferencedException ) {
                    logger.info( bl_library.logRecord( [ businessRule, "Target already referenced for", skuID ] ));
                } else {
                    logger.info( bl_library.logRecord( [ "Exception occurred", businessRule, currentObjectID, skuID, e ] ) );
                    throw(e);
                }
            }
        }
    }
}
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#assignToUser">assignToUser</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Thu Mar 23 2023 15:02:37 GMT+0000 (Coordinated Universal Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
